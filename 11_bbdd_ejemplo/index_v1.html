<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario con AJAX</title>
    <script>
        function enviarFormulario(event) {
            event.preventDefault(); // Evitar el envío tradicional del formulario

            const nombre = document.getElementById('nombre').value;
            const email = document.getElementById('email').value;
            const telefono = document.getElementById('telefono').value;

            const datos = new FormData();
            datos.append('nombre', nombre);
            datos.append('email', email);
            datos.append('telefono', telefono);

            fetch('insertar_mysqli.php', {
                method: 'POST',
                body: datos
            })
            .then(response => response.text())
            .then(data => {
                alert('Datos enviados correctamente: ' + data);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Hubo un error al enviar los datos.');
            });
        }

        function cargarListado() {
            fetch('listado_mysqli.php')
            .then(response => response.json())
            .then(data => {
                const tabla = document.getElementById('tablaListado');
                tabla.innerHTML = ''; // Limpiar contenido previo

                // Crear encabezados de la tabla
                const encabezado = tabla.insertRow();
                Object.keys(data[0]).forEach(key => {
                    const th = document.createElement('th');
                    th.textContent = key;
                    encabezado.appendChild(th);
                });

                // Crear filas de la tabla
                data.forEach(item => {
                    const fila = tabla.insertRow();
                    Object.values(item).forEach(value => {
                        const celda = fila.insertCell();
                        celda.textContent = value;
                    });
                });
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Hubo un error al cargar el listado.');
            });
        }
    </script>
</head>
<body>
    <h1>Formulario</h1>
    <form id="formulario" onsubmit="enviarFormulario(event)">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" name="nombre" required><br><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>

        <label for="telefono">Teléfono:</label>
        <input type="tel" id="telefono" name="telefono" required><br><br>

        <button type="submit">Enviar</button>
    </form>

    <h2>Listado</h2>
    <button onclick="cargarListado()">Cargar Listado</button>
    <table border="1" id="tablaListado"></table>
</body>
</html>